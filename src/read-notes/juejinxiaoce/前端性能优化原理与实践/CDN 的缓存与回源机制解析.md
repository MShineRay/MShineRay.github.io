# CDN 的缓存与回源机制解析

> CDN （Content Delivery Network，即内容分发网络）指的是一组分布在各个地区的服务器。这些服务器存储着数据的副本，因此服务器可以根据哪些服务器与用户距离最近，来满足数据的请求。 CDN 提供快速服务，较少受高流量影响。

### CDN的核心功能特写

CDN 的核心点有两个，一个是**缓存**，一个是**回源**。

“缓存”是把资源 copy 一份到 CDN 服务器上这个过程，
“回源”是CDN 发现自己没有这个资源（一般是缓存的数据过期了），转头向根服务器（或者它的上层服务器）去要这个资源的过程。

### CDN 与前端性能优化
**CDN 往往被用来存放静态资源**。
它的核心任务在于**生成动态页面或返回非纯静态页面**，这两种过程都是需要计算的。
业务服务器仿佛一个车间，车间里运转的机器轰鸣着为我们产出所需的资源；
CDN 服务器则像一个仓库，它只充当资源的“栖息地”和“搬运工”。

“静态资源”，就是像 JS、CSS、图片等**不需要业务服务器进行计算即得的资源**。
“动态资源”，是需要**后端实时动态生成的资源**，较为常见的就是 JSP、ASP 或者依赖服务端渲染得到的 HTML 页面。

什么是“非纯静态资源”呢？它是指**需要服务器在页面之外作额外计算的 HTML 页面**。当我打开某一网站之前，该网站需要通过权限认证等一系列手段确认我的身份、进而决定是否要把 HTML 页面呈现给我。这种情况下 HTML 确实是静态的，但它**和业务服务器的操作耦合**，我们把它丢到CDN 上显然是不合适的。

### CDN 的实际应用

静态资源本身具有访问频率高、承接流量大的特点，因此静态资源加载速度始终是前端性能的一个非常关键的指标。CDN 是静态资源提速的重要手段，在许多一线的互联网公司，“静态资源走 CDN”并不是一个建议，而是一个规定。

### CDN 优化细节

如何让 CDN 的效用最大化？它涉及到 CDN 服务器本身的性能优化、CDN 节点的地址选取等。
CDN 的域名选取。

我们注意到业务服务器的域名是这个：

```
www.taobao.com

```

而 CDN 服务器的域名是这个：

```
g.alicdn.com

```


> Cookie 是紧跟域名的。同一个域名下的所有请求，都会携带 Cookie。大家试想，如果我们此刻仅仅是请求一张图片或者一个 CSS 文件，我们也要携带一个 Cookie 跑来跑去（关键是 Cookie 里存储的信息我现在并不需要），这是一件多么劳民伤财的事情。Cookie 虽然小，请求却可以有很多，随着请求的叠加，这样的不必要的 Cookie 带来的开销将是无法想象的……

同一个域名下的请求会不分青红皂白地携带 Cookie，而静态资源往往并不需要 Cookie 携带什么认证信息。把静态资源和主页面置于不同的域名下，完美地避免了不必要的 Cookie 的出现！

以电商网站静态资源的流量之庞大，如果没把这个多余的 Cookie 拿下来，不仅用户体验会大打折扣，每年因性能浪费带来的经济开销也将是一个非常恐怖的数字。